# 数据链路层
数据链路层使用的信道:
* 点对点信道:用于一对一的通信方式
* 广播信道:一对多的广播通信方式.由于广播信道上连接的主机很多,所以必须使用专用的**共享信道协议**来协调这些主机的数据发送

不同的链路层可能采用不同的数据链路层协议

## 一. 使用点对点信道的数据链路层
### 1.数据链路和帧
* 链路: 链路是一条无源的点到点的物理线路段,中间没有任何其他的交换节点
    * 一条链路只是一条通路的一个组成部分
* 数据链路是 物理线路 + 通信协议.
    * 把实现通信协议的硬件和软件加到链路上,就构成了数据链路.
    * 最常用的方法是使用**适配器也就是网卡**来实现这些协议的硬件和软件
* 帧是数据链路层按照具体协议要求由比特流装配而成的.
    * 数据是一帧一帧地传送的,当出现差错时,就可以只将有差错的帧重传一次,从而避免将全部数据进行重传
### 2. 数据链路层的三个基本问题
数据链路层有许多种协议,但三个基本问题是公共的:
1. 封装成帧
2. 透明传输
3. 差错控制

#### 1. 封装成帧
* 封装成帧就在在一段数据的前后分别添加首部和尾部,
* 首部和尾部的重要作用就是进行**帧定界**

![](https://ws1.sinaimg.cn/large/0077h8xtly1fr7pniddyyj30ww0eawge.jpg)

##### 关于帧的几种方法

1. 用控制字符进行帧定界
    * 当数据是由可打印的ASCII码组成的文本文件时,可以用特殊的控制字符表示**帧定界符**,一个放在帧首部表示开始,一个放在尾部表示帧的结束


![](https://ws1.sinaimg.cn/large/0077h8xtly1fr7q1p23gdj30y90au75i.jpg)

2. 帧同步
    * 帧同步是为了是接收方能够从收到的比特流中**准确区别出一帧的开始和结束**
    * 因此帧的设计必须要有帧首和帧尾的标识方法.另外为了检测传输中出现的差错和保持帧传输的有序性,帧的结构设计中还要包括校验信息和帧序号
    * 实现帧同步的四种方法:
        1. 字节计数法
        2. 字符填充法
        3. 比特填充法
        4. 违法编码法

字节计数法    
* 以一个特殊的字符表示一帧的开始(比如SOH控制字符),以一个专门的字段表示一帧的字节数.接收方可以通过表征帧开始的特殊字符区别出帧的开始和帧的字节数,从而确定帧的终止位置.
* 这种帧同步方法不会引起数据信息与其他控制信息的混淆,因而不采用任何措施就可以实现数据的透明性,任何数据都可以不受限制地传输.
* count字段具有脆弱性,其值若有差错将导致后面的比特都无法定位.

字符填充法
* 使用**特定字符**界定一帧的起始与终止.为了不使数据信息位中出现与特定字符相同的字符,可以在特性字符前加一个转义控制字符(如ESC),从而达到数据的透明性.
* 这种方法的特定字符依赖于所采用的字符编码集,故兼容性较差,实现起来复杂


比特填充法
* 用一组**特定的比特组合标志一帧的起始与终止**.为了不使数据信息中出现与特定的比特组合相同的比特串,可以在数据信息位中填充某一比特位,使两者不混淆
* 比特填充法很容易由硬件实现,其性能优于字符填充法

违法编码法(以太网使用这种方式)
* **采用特定的比特编码界定帧的起始和终止**,一般在物理层实现
* 曼彻斯特编码和差分曼彻斯特编码属于违法编码法
* 在物理层采用特定的比特编码方法时采用.比如曼彻斯特编码方法,将数据1编码成`高低电平对`,0编码成`低高电平对`. 而剩下的`低低 和 高高`电平对在数据比特中就是违法的,从而可以利用这些违法编码来界定帧的起始和终止位置

#### 2. 透明传输
* 传输中存在的问题: 如果数据中的某个字节的二进制代码恰好和SOH或EOT帧头和帧尾编码一样,数据链路层就会错误地获取帧的边界.  
![](https://ws1.sinaimg.cn/large/0077h8xtly1fr7r38t1n6j30z90e30uw.jpg)
* 解决上述问题的方法:**字节填充或字符填充**
    * 发送端的数据链路层在原始数据中出现的控制字符SOH或EOT的前面**插入一个转义字符ESC**.如果ESC也出现在数据中,就在转义字符的前面也加一个转义字符.
    * 接受端的数据链路层在将数据送往网络层之前删除所有插入的转义字符

#### 3. 差错检验
* 在一段时间内,`传输错误的比特数/传输总比特数 = 误码率`,误码率与信噪比有很大的关系
* 数据链路层的差错控制是保证相邻节点之间的传输差错控制在所允许的最小范围内

##### 循环冗余检验
在发送端首先将数据按每组k个划分为组，假设带传送的一组数据`M = 101001  (k = 6)`.我们在M的后面再添加供差错检测用的n位**冗余码**一起发送  
* 冗余码的计算:  
