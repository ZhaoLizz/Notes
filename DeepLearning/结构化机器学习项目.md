# 结构化机器学习项目

## 1. 单一数字评估标准

在评估两个分类器的效果的时候,需要有一个**单实数评估指标**.  

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftxmmmr142j30rw05ntd9.jpg)

比如在评估A,B两个分类器的时候, 同时有查准率和查全率两个指标,我们就不容易区分两个分类器的表现.  

因此引入 **F1指标**,$F_1 = \frac{2}{\frac{1}{P} + \frac{1}{R}}$把两个评估标准转变为 **单一数字评估标准**,这样就能很容易的评估分类器性能



## 2. 满足指标和优化指标

有时候把所有的判决标准组合成单实数评估指标并不容易,这时可以 **设立满足指标和优化指标**

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftxmxsk0rmj30ql06p41e.jpg)

对于分类器的准确率和执行时间,我们可以把准确率设立为优化指标,把时间设置为满足指标.

对于准确率,可以一直尝试去优化使之最大.对于时间,只要它满足一定的条件,就可以不再理会.

在有N个判决标准的时候,可以取一个标准作为优化指标,其他的作为满足指标

![1533362950292](C:\Users\Administrator\AppData\Local\Temp\1533362950292.png)

## 3.修改评估标准

如果分类器把色情图片分类为猫,会带来非常不好的结果.这时候就要手动处理权重,在损失函数中加大色情图片的惩罚权重.

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftxqen3gsrj30lv06ygob.jpg)

如果想归一化常数,就是对w_i求和,这样错误率仍然在0和1之间

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftxqg8u2glj30dc03h3yh.jpg)

另一种常见的情况是,我们开发集,测试集中的图片都是高质量的,而用户使用的却是模糊的低质量照片,这时模型的表现就很差.此时就应该 **修改开发测试集,让数据更能反映实际需要处理好的数据**.

总结:如果当前指标和当前用来评估的数据和**现实应用**的数据关系不大,那么就应该改变开发测试集,让它们更好地反映算法需要处理好的数据.



## 4. 划分训练/开发/测试集

* 训练集:训练模型
* 验证(开发)集:用于调参,验证模型性能
* 测试集:检测最终模型的性能

###  划分方式

在小型的数据集(几百几千或者一万个样本)中,可以使用传统的划分方法.而在处理大规模数据集(一百万训练样本),通常使用98%训练集,1%开发集,1%测试集.把大量的数据分到训练集,然后把少量的数据分到开发集和测试集.

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftxp76898qj30na0bfjtf.jpg)

## 5. 进行误差分析

假设识别猫的模型获取了90%的正确率,针对10%的错误率,我们可以做如下分析.

* 手动观察所有分类错误的样本,**把这些错误的原因归类**.比如把狗识别为猫,把猫科动物识别为猫,或者图片不清晰导致.

  ![](http://ww1.sinaimg.cn/large/0077h8xtly1ftxz1px5k4j30q8086771.jpg)

* 对这些样本错误的情况做**比例统计**,看看哪些错误占得比例比较高,然后就可以**针对比例较高的错误**去针对性地优化

注意一定要针对错误率较高的错误类型去优化,如果优化比例低的错误,就算全部优化也不会对模型性能有大的提升.

## 6. 处理标记错误的数据

* 如果错误标记出现在**训练集**中,某个样本$X_i$的$y_i$标签标记错了,比如把猫标记为了狗:

  * 如果这些**错误是随机产生的**(比如做标记的人不小心弄错了),只要数据集足够大,那么可以放着这些错误暂时不管,不需要花太多时间去修复它(当然如果能修复的话更好).
  * 注意深度学习算法对随机误差很健壮,但对系统性错误就不够健壮了.如果做标记的人一直把白色的狗标记成猫,就必须修复这个问题.

* 如果错误标记出现在 **开发集和测试集**中

  * 我们在做误差分析的时候,可以加一个错误类别为 **标签错误**.然后统计这类错误的比例.

    * 如果标签错误比例较高,就去修复错误的标签.
    * 如果比例较低但是这些错误严重影响了我们**在开发集上评估算法的能力**,就应该花时间去修复错误的标签.

    ![](http://ww1.sinaimg.cn/large/0077h8xtly1fty09orkudj30pp091di7.jpg)

    

### 修改标签的原则

* **修改要同时作用在开发集合测试集上**.如果修改了开发集,测试集也必须做同样的修正.因为开发集和测试集必须是相同的分布.开发集确定了训练的目标,当在开发集上达到了目标时,要能够推广到测试集上.
* 同时检验算法判断正确和错误的样本.有可能存在模型判断的结果是错的,但是恰好标签标记的也是错的,这样的结果就是看起来正确的.在这种情况下,修正标签会使得算法的判断由对变错.虽然通常不会花大量时间去做这项任务,但是要了解一下.

## 7. 快速搭建第一个系统并迭代优化

在搭建一个新的系统时,我们有很多方向可以做优化.这时应该遵循以下开发原则:

1. 建立训练集,开发集,测试集
2. 快速构建起一个简陋的新系统,然后开始迭代.
3. 运用误差分析/偏差方差分析确定最有可能最大限度改进系统的问题,然后去集中精力优化这个问题.
4. 依次解决误差分析发现的问题



## 8.处理不同分布的数据集

假设我们有20万张高清的猫照片,1万张用户上传的相对模糊的照片.如果直接把20w和1w混合打乱后划分训练集和测试集,那么处理用户上传的图片时效果就很差,因为我们的测试集和开发集和用户上传的图片分布不同

解决方法:

* 可以在1w张图片中取出一半(5000张)打乱放入训练集,剩下的作为开发集和测试集

  ![](http://ww1.sinaimg.cn/large/0077h8xtly1ftytd6b6zxj30xn0iwatc.jpg)

  

## 9. 数据分布不同时的偏差和方差

如果训练集误差是1%,开发集误差是10%.由于数据分布不同,我们不能直接推断方差过大,因为可能存在以下两种情况:

* 训练集是高分辨率,开发集模糊难以识别: 模型本身不存在方差问题,只是反映了开发集的图片更难准确分类
* 确实是因为模型存在方差问题.



用来确定问题所在的方法:

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftywhxmg3aj30n607n42j.jpg)

* 随机打乱训练集,然后分出一部分训练集作为 **训练-开发集**. 训练集和训练-开发集分布一致,开发集和测试集分布一致.

* 只在训练集上训练模型,而不适用训练开发集.在训练完成后,分别在训练集,训练开发集,开发集上测试准确率

  ![](http://ww1.sinaimg.cn/large/0077h8xtly1ftywmc9ng8j30qq07wacg.jpg)

  * 训练集误差和训练-开发集误差的差值表示真实存在的方差
  * 训练-开发集误差和开发集误差的差值表示数据分布不一致造成的偏差
  * 上图可以看出,左边一列数据的问题在于方差过大,右边一列数据的问题在于数据分布不同



另一种情况是,模型在开发集上的表现比在训练-开发集上的表现更好,这就是说明训练数据其实比开发集和测试集难识别地多.

![](http://ww1.sinaimg.cn/large/0077h8xtly1ftyxgkl5cwj30qy0c8tcs.jpg)

