## 一.分段

**连续内存分配** 的缺点:

* 分配给一个程序的物理内存是连续的
* 内存的利用率低
* 存在外碎片,内碎片的问题

**非连续内存分配**的优点

* 一个程序的物理地址空间是非连续的
* 具有更好的内存利用和管理能力
* 允许**共享**代码和数据
* 支持动态加载和动态链接

**非连续内存分配**的缺点

* 虚拟地址和物理地址之间的转换需要开销



![](http://ww1.sinaimg.cn/large/0077h8xtly1fvna8a3lgxj30ry0hk44e.jpg)

把连续的逻辑地址空间**通过分段技术 映射**分散到多个物理地址空间

### 分段寻址方案

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvnamai99lj30po0glgr8.jpg)

* 段表示一段连续的逻辑地址空间,逻辑地址空间加上段内偏移就是把这一段逻辑地址空间映射到物理内存

* 存储这个数据结构有两种方式,一个是把段号和段内偏移分开存储,一个是一起存储

#### 分段寻址的硬件实现方案

* 段表存放存放段的起始地址(段号)和段的长度
* 需要内存空间时,CPU就根据段表查找到段的起始地址,并查看段的这**一段长度**是否满足**段表中段的长度要求** 
* 如果访问合法,就是一次合法的寻址,就加上偏移量,找到物理地址
* 段表由操作系统来建立

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvnt9cy6x5j30ql0h0qaf.jpg)



## 二. 分页

* 在分段机制中,段的尺寸是可变的,在分页机制中,页的大小是不变的

* 划分物理内存至固定大小的帧,同时也需要划分逻辑地址空间至相同大小的页(大小是2的幂次方,便于硬件实现)
  * frame帧代表物理页,page页代表逻辑页
  * 需要建立分页方案,把逻辑地址转换为物理地址(页表,MMU/TLB)



### 帧

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvnuiq81d4j30ps0hbgsr.jpg)

### 页

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvnvpshac2j30l40gwwkn.jpg)

### 页寻址机制

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvnvrz6r7gj30r80hg12c.jpg)

* 逻辑地址由两个部分组成: 页号和页偏移
* 页表内容:
  *  key页号: val 帧号,可以通过页号查询到帧号
  * 页表基址: 页表的偏移
  * 查询时,通过页号找到帧号,然后在帧号的基础上加上页表基址偏移,找到物理地址
  * 页表由操作系统建立
* 特点
  * 由页映射到帧
  * 页是连续的虚拟内存,帧是非连续的物理内存
  * 不是所有的页都有对应的帧
  * 逻辑地址空间是连续的页,但是映射到物理内存空间就有可能不是连续的了



## 三. 页表和TLB

#### 页表

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvnyva1bwwj30oo0g1afy.jpg)

* 页表的值为  key 页号 : val 帧号
* 频繁访问和存储页表需要额外的运行时间和内存空间,所以需要TLB缓存机制来解决

#### TLB

![](http://ww1.sinaimg.cn/large/0077h8xtly1fvo71ogdiuj30mu0fejye.jpg)

* TLB快表中,Key是段号,Val是内存中的页表的标志号